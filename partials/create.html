<script type="text/ng-template" id="btns.html">
	<button ng-click="add(node.nodes, 'if', 'se')" class="btn">+ IF</button>
    <button ng-click="add(node.nodes, 'write', 'escrever')" class="btn">+ WRITE</button>
    <button ng-click="add(node.nodes, 'for', 'for')" class="btn">+ FOR</button>
    <button ng-click="add(node.nodes, 'attr', 'attr')" class="btn">ATTR</button>
</script>

<script type="text/ng-template"  id="nodes.html">
	<ul>
        <li ng-repeat="node in node.nodes" ng-include="getTemplate(node)"></li>
    </ul>
</script>

<script type="text/ng-template"  id="tree_item_renderer.html">
    {{node.name}} {{node.type}}
    <button ng-click="delete(node)" ng-show="node.nodes.length > 0" class="btn">Limpar</button>
    <span ng-include="'nodes.html'"></span>
    <span ng-include="btns.html"></span>
</script>

<script type="text/ng-template"  id="start.html">
    {{node.name}} {{node.type}}
    <button ng-click="delete(node)" ng-show="node.nodes.length > 0" class="btn">Limpar</button>
    <span ng-include="'nodes.html'"></span>
    <span ng-include="'btns.html'"></span>
</script>

<script type="text/ng-template"  id="for.html">
    <div class="repeat">
        <i class="icon-repeat"></i>
        {{node.name}} <span edit-in-place='node.times'></span> vezes.
        <button class="btn pull-right" ng-click="removeItem(node.parent, node)"><i class="icon icon-trash"></i></button>
        <button ng-click="delete(node)" ng-show="node.nodes.length > 0" class="btn">Limpar</button>
        <span ng-include="'nodes.html'"></span>
        <span ng-include="'btns.html'"></span>
    </div>
</script> 
<script type="text/ng-template"  id="if.html">
    {{node.name}} 
                    <select ng-model='teste'>
                        <option ng-repeat="var in programs[currentProgram].functions[0].vars">{{var.name}}</option>
                    </select> igual <input type="text" value="VAR">
    <button class="btn pull-right" ng-click="removeItem(node.parent, node)"><i class="icon icon-trash"></i></button>
    <button ng-click="delete(node)" ng-show="node.nodes.length > 0" class="btn">Limpar</button>
    <span ng-include="'nodes.html'"></span>
    <span ng-include="'btns.html'"></span>

</script>
<script type="text/ng-template"  id="write.html">
    <div class="write">
        {{node.name}}
        (<span select-variable="node.variable" select-model="node.variable" select-vars="programs[currentProgram].functions[0].vars"></span> + )
        
        <span class="badge badge-important pull-right" ng-show="node.variable==''"><i class="icon icon-exclamation"></i></span>
    </div>  
</script>

<script type="text/ng-template"  id="var.html">
    <i>{{node.name}}</i> <span edit-in-place='node.data.varName'></span> = <input type="text" value="VAR"> {{node.data.varName}}
</script>

<script type="text/ng-template"  id="attr_var.html">
    (<span ng-repeat="node in node.nodes">
        <span ng-show="node.nodes.length>0" ng-include="'attr_var.html'">
        </span>
        <span ng-show="node.type=='value'">
            <span ng-show="node.nodes.length==0">
                <span edit-in-place="node.value"></span>
            </span>
        </span>
        <span ng-show="node.type=='op'">
        +
        </span>
    </span>)
</script>

<script type="text/ng-template"  id="attr.html">
    <div class="attr">
    <span select-variable="node.variable" select-model="node.variable" select-vars="programs[currentProgram].functions[0].vars"></span> recebe o valor  
            <span edit-in-place="node.value"></span>
            <span ng-include="'attr_var.html'">as</span>
            <span class="dropdown">
                    <button class="btn btn-mini" data-toggle="dropdown"><i class="icon icon-align-justify"></i></button>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                        <li class="divider"></li>
                        <li><a role="menuitem" href="#">Somar</a></li>
                        <li><a role="menuitem" href="#">Subtrair</a></li>
                        <li><a role="menuitem" href="#">Dividir</a></li>
                        <li><a role="menuitem" href="#">Multiplicar</a></li>
                    </ul>
            </span>

    </div>
</script>


<div class="container">
    <ul class="nav nav-tabs">
        <li class="dropdown" ng-repeat="program in programs">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">{{program.programName}} <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li ng-repeat="func in program.functions"><a href="#dropdown1" data-toggle="tab">{{func.name}}</a></li>
              <li><a href="#dropdown1" data-toggle="tab">create a function</a></li>
              <li><a href="#dropdown1" data-toggle="tab">create a method</a></li>
            </ul>
        </li>
    </ul>
    <div class="row-fluid" ng-repeat="prog in programs">
        <div class="span6">
            <div class="ivprog" ng-repeat="func in prog.functions">
                <div class="parameters">
                    <h5><i class="icon icon-th-list" style="font-size: 14px;"></i> Parâmetros <button class="btn" ng-click="addParam()"><i class="icon icon-plus"></i></button></h5>
                    <span class="var" ng-repeat="param in func.params">&nbsp;<span edit-in-place='param.name'></span> = <span edit-in-place='param.initialValue'></span> <span edit-in-place="param.opa" /> <button class="btn btn-mini" ng-click="removeParam(var)"><i class="icon icon-remove"></i></button></span>
                    <span class="clearfix"></span>
                </div>
                <div class="variables">
                    <h5><i class="icon icon-th-list" style="font-size: 14px;"></i> Variáveis locais <button class="btn" ng-click="addVar()"><i class="icon icon-plus"></i></button></h5>
                    <span class="var" ng-repeat="var in func.vars">&nbsp;<span edit-in-place='var.name'></span> = <span edit-in-place='var.initialValue'></span> <div class="btn-group"><button class="btn btn-mini" ng-click="configVar(var)"><i class="icon icon-wrench"></i></button><button class="btn btn-mini" ng-click="removeVar(var)"><i class="icon icon-remove"></i></button></div></span>
                    <span class="clearfix"></span>
                </div>
                
                <ul>
                    <li ng-repeat="node in programs[currentProgram].functions[0].nodes" ng-include="getTemplate(node)">
                    </li>

                    <button ng-click="add(programs[currentProgram].functions[0].nodes, 'if', 'se')" class="btn">+ IF</button>
                    <button ng-click="add(programs[currentProgram].functions[0].nodes, 'read', 'ler')" class="btn">+R</button>
                    <button ng-click="add(programs[currentProgram].functions[0].nodes, 'write', 'escrever')" class="btn">+W</button>
                    <button ng-click="add(programs[currentProgram].functions[0].nodes, 'for', 'repetir')" class="btn">+ FOR</button>
                    <button ng-click="add(programs[currentProgram].functions[0].nodes, 'attr', 'attr')" class="btn">ATTR</button>
                </ul>

            </div>
        </div>
        <div class="span6">
            <h4>Source</h4>
            <div class="source">
                <div class="variables">
                    <i>var</i><span class="var" ng-repeat="var in vars"> &nbsp;<b>{{var.name}}</b> = {{var.initialValue}}<span ng-show="vars.length>1&&$index<vars.length-1">,</span></span><span ng-show="vars.length>1">;</span>
                </div>
            </div>
            <h4>Output</h4>
            <div class="btn-group"><button class="btn" ng-click="run()"><i class="icon icon-play"></i></button><button class="btn" ng-click="clearOutput()">Clear</button></div>
            <div class="output">

            </div>
        </div>
    </div>
</div>

